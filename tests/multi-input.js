const UTIL = require('util');
const ckb_annotated = require("hw-app-ckb/lib/annotated.js");

// # Signing valid multi-input tx should pass - 1

// # wallet get-capacity --lock-arg 0x8d5520741f06a062543cdea9a21fc20d07ee29b0
// # total: 899.997 (CKB)
// # wallet get-capacity --address ckt1qyqw2fsdswd8s6kz4yy3s80e5s3lrma7sc7spdxnqe
// # total: 1000.0 (CKB) "m/44'/309'/0'/0/0"
// # wallet transfer --from-account 0x8d5520741f06a062543cdea9a21fc20d07ee29b0 --to-address ckt1qyqwggd90hnw6kqp39rrzvwvkm2cg0dtjawspc6k35 --capacity 1500 --tx-fee 0.0001  --derive-change-address ckt1qyqgx33w4lvn7zje32ext9l9ekn9ywe0c9fsay4tw4 --derive-change-address-length 5

// # Input Cells of transactions
// # transaction:
// #   version: 0
// #   cell_deps:
// #     - out_point:
// #         tx_hash: 0x01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93
// #         index: 0
// #       dep_type: dep_group
// #   header_deps: []
// #   inputs:
// #     - since: 0x0 (absolute block(0))
// #       previous_output:
// #         tx_hash: 0x276d5447f20df863b13bcafd63de2ad851e4f35eda337268b19ab0cf7c29c608
// #         index: 1
// #     - since: 0x0 (absolute block(0))
// #       previous_output:
// #         tx_hash: 0x40e54fc2d1aabbd39ae6cd8a5df922995dd856f24f670d3d5f283690a534a544
// #         index: 0
// #   outputs:
// #     - capacity: "300.0"
// #       lock:
// #         code_hash: 0x5c5069eb0857efc65e1bca0c07df34c31663b3622fd3876c876320fc9634e2a8 (multisig)
// #         args: 0x98ac6e82110a9ef50923375bfdcbef6fd979b8ac6000003804080720
// #         hash_type: type
// #       type: ~
// #     - capacity: "899.997"
// #       lock:
// #         code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
// #         args: 0x8d5520741f06a062543cdea9a21fc20d07ee29b0
// #         hash_type: type
// #       type: ~
// #   outputs_data:
// #     - 0x
// #     - 0x
// #   witnesses:
// #     - 0x5500000010000000550000005500000041000000ad2eee29bd91556d68b6313ea8957cf2ae3eb8266241897147486f4a6464171615855e59af5a763a82296886d3c22628fc1aed94e55b1ee050661618c588144c00
// #     - 0x
// #   hash: 0x6127c3e68295fb18d6ed55256f5ac3bb81c3446c671ff029db7ad7992bc7b394

// # transaction:
// #   version: 0
// #   cell_deps:
// #     - out_point:
// #         tx_hash: 0x01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93
// #         index: 0
// #       dep_type: dep_group
// #   header_deps: []
// #   inputs:
// #     - since: 0x0 (absolute block(0))
// #       previous_output:
// #         tx_hash: 0x39738e9ad7b3ac419a51a9d301cb96722d3e01f2ffbae7779bd31791fc24adad
// #         index: 1
// #   outputs:
// #     - capacity: "1000.0"
// #       lock:
// #         code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
// #         args: 0xe5260d839a786ac2a909181df9a423f1efbe863d
// #         hash_type: type
// #       type: ~
// #     - capacity: "19999983549.9828"
// #       lock:
// #         code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
// #         args: 0xcc4e78b857b8ea477304925ac0f67b7348b86761
// #         hash_type: type
// #       type: ~
// #   outputs_data:
// #     - 0x
// #     - 0x
// #   witnesses:
// #     - 0x55000000100000005500000055000000410000002e5b82f6892bfacc4c4326079fa5117de6b0a227da3ab6c4d3bd837837cf13830ad652472329e12301d52364cc5df64ee81d7adfd00c36f16bdc69f643740ffb00
// #   hash: 0xdccc65d2b03f6b30d8cb48a3ab630ac26c73257557ce62320cc911a02fb816b4

// # Transaction being signed
// # version: 0
// # cell_deps:
// #   - out_point:
// #       tx_hash: 0x01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93
// #       index: 0
// #     dep_type: dep_group
// # header_deps: []
// # inputs:
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x6127c3e68295fb18d6ed55256f5ac3bb81c3446c671ff029db7ad7992bc7b394
// #       index: 1
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0xdccc65d2b03f6b30d8cb48a3ab630ac26c73257557ce62320cc911a02fb816b4
// #       index: 0
// # outputs:
// #   - capacity: "1500.0"
// #     lock:
// #       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
// #       args: 0xe421a57de6ed580189463131ccb6d5843dab975d
// #       hash_type: type
// #     type: ~
// #   - capacity: "399.9969"
// #     lock:
// #       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
// #       args: 0x83462eafd93f0a598ab26597e5cda6523b2fc153
// #       hash_type: type
// #     type: ~
// # outputs_data:
// #   - 0x
// #   - 0x
// # witnesses:
// #   - 0x5500000010000000550000005500000041000000456049d307a11353d7520d1756c38ef6bcb20b00cc90536420768cb6e08916475ceed3b38f8f05481f2d2b7deba4fd3335e22495c00a8d7f8715a4258378cdfe00
// #   - 0x55000000100000005500000055000000410000007766519eed01f9534e44b03b0fcc0bcd7bbc1d96f7fb9373707e260df27739f15c07811508ef5b460f5e09773c62436ea0ccff4c564aff3d561c7a097e1a186901
// # hash: 0x38e181c8cd1f37c737837675e67e80054f129b962e301fcecacbf59d6531659a

// @test "Signing valid multi-input tx should pass - 1 - (Input 1)" {
//   run sendTransaction f504000018000000280000004000000044000000e1040000030000002c0000803501008000000080050000002c00008035010080000000800100000000000000020000009d0400001c00000020000000490000004d000000bb03000089040000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000006e0300000c000000d7010000cb0100000c0000003800000000000000000000006127c3e68295fb18d6ed55256f5ac3bb81c3446c671ff029db7ad7992bc7b39401000000930100001c00000020000000490000004d000000a90000007f010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000020000000000000000000000276d5447f20df863b13bcafd63de2ad851e4f35eda337268b19ab0cf7c29c60801000000000000000000000040e54fc2d1aabbd39ae6cd8a5df922995dd856f24f670d3d5f283690a534a54400000000d60000000c000000750000006900000010000000180000006900000000ac23fc06000000510000001000000030000000310000005c5069eb0857efc65e1bca0c07df34c31663b3622fd3876c876320fc9634e2a8011c00000098ac6e82110a9ef50923375bfdcbef6fd979b8ac600000380408072061000000100000001800000061000000207066f414000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce801140000008d5520741f06a062543cdea9a21fc20d07ee29b0140000000c000000100000000000000000000000970100000c000000380000000000000000000000dccc65d2b03f6b30d8cb48a3ab630ac26c73257557ce62320cc911a02fb816b4000000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d9300000000010000000001000000000000000000000039738e9ad7b3ac419a51a9d301cb96722d3e01f2ffbae7779bd31791fc24adad01000000ce0000000c0000006d0000006100000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d6100000010000000180000006100000040bf094de86bc11b490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000cc4e78b857b8ea477304925ac0f67b7348b86761140000000c000000100000000000000000000000ce0000000c0000006d00000061000000100000001800000061000000005cb2ec22000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e421a57de6ed580189463131ccb6d5843dab975d6100000010000000180000006100000010d52a5009000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000083462eafd93f0a598ab26597e5cda6523b2fc153140000000c000000100000000000000000000000140000000c000000100000000000000000000000
//   promptsCheck 6 tests/sign-valid-multi-input-tx-1-prompts.txt
//   rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
//   txhash_and_witness=38e181c8cd1f37c737837675e67e80054f129b962e301fcecacbf59d6531659a5500000000000000550000001000000055000000550000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
//   run check_signature "038000002c8000013580000000" "$txhash_and_witness" "$rv"
//   diff <(echo $output) - <<<"Signature Verified Successfully"
// }


// @test "Signing valid multi-input tx should pass - 1 - (Input 2)" {
//   run sendTransaction fd0400001800000030000000480000004c000000e9040000050000002c00008035010080000000800000000000000000050000002c00008035010080000000800100000000000000020000009d0400001c00000020000000490000004d000000bb03000089040000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000006e0300000c000000d7010000cb0100000c0000003800000000000000000000006127c3e68295fb18d6ed55256f5ac3bb81c3446c671ff029db7ad7992bc7b39401000000930100001c00000020000000490000004d000000a90000007f010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000020000000000000000000000276d5447f20df863b13bcafd63de2ad851e4f35eda337268b19ab0cf7c29c60801000000000000000000000040e54fc2d1aabbd39ae6cd8a5df922995dd856f24f670d3d5f283690a534a54400000000d60000000c000000750000006900000010000000180000006900000000ac23fc06000000510000001000000030000000310000005c5069eb0857efc65e1bca0c07df34c31663b3622fd3876c876320fc9634e2a8011c00000098ac6e82110a9ef50923375bfdcbef6fd979b8ac600000380408072061000000100000001800000061000000207066f414000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce801140000008d5520741f06a062543cdea9a21fc20d07ee29b0140000000c000000100000000000000000000000970100000c000000380000000000000000000000dccc65d2b03f6b30d8cb48a3ab630ac26c73257557ce62320cc911a02fb816b4000000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d9300000000010000000001000000000000000000000039738e9ad7b3ac419a51a9d301cb96722d3e01f2ffbae7779bd31791fc24adad01000000ce0000000c0000006d0000006100000010000000180000006100000000e8764817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d6100000010000000180000006100000040bf094de86bc11b490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000cc4e78b857b8ea477304925ac0f67b7348b86761140000000c000000100000000000000000000000ce0000000c0000006d00000061000000100000001800000061000000005cb2ec22000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e421a57de6ed580189463131ccb6d5843dab975d6100000010000000180000006100000010d52a5009000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000083462eafd93f0a598ab26597e5cda6523b2fc153140000000c000000100000000000000000000000140000000c000000100000000000000000000000
//   promptsCheck 6 tests/sign-valid-multi-input-tx-2-prompts.txt
//   rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
//   txhash_and_witness=38e181c8cd1f37c737837675e67e80054f129b962e301fcecacbf59d6531659a5500000000000000550000001000000055000000550000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
//   run check_signature "058000002c80000135800000000000000000000000" "$txhash_and_witness" "$rv"
//   diff <(echo $output) - <<<"Signature Verified Successfully"
// }


// # Signing valid multi-input tx should pass - 2
// # 3 input cells 2 signer
// # wallet transfer --from-account 0x8d5520741f06a062543cdea9a21fc20d07ee29b0 --to-address ckt1qyqwggd90hnw6kqp39rrzvwvkm2cg0dtjawspc6k35 --capacity 3200 --tx-fee 0.0001  --derive-change-address ckt1qyqxyt6gphlcwvw3tjpj6g35ae8da5x0uwvqrprflz --derive-change-address-length 6

// # Final transaction
// # version: 0
// # cell_deps:
// #   - out_point:
// #       tx_hash: 0x01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93
// #       index: 0
// #     dep_type: dep_group
// # header_deps: []
// # inputs:
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x741afd3182e163d0936be988f7fa3d317b16765d3fb48f186d6d27dee4fb1f52
// #       index: 0
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x23901dc31e18374f9a088f0033dcca6122f4e3646808c2e8b25983c4807e66b7
// #       index: 1
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x619d37dd5910e4970a81546146f92d7eecb66a6174f8cb029f003c878c6243e4
// #       index: 0
// # outputs:
// #   - capacity: "3200.0"
// #     lock:
// #       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
// #       args: 0xe421a57de6ed580189463131ccb6d5843dab975d
// #       hash_type: type
// #     type: ~
// #   - capacity: "3239.9989"
// #     lock:
// #       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
// #       args: 0x622f480dff8731d15c832d2234ee4eded0cfe398
// #       hash_type: type
// #     type: ~
// # outputs_data:
// #   - 0x
// #   - 0x
// # witnesses:
// #   - 0x55000000100000005500000055000000410000000674917591ea9528b081712edc347809116974840bd56021ab05e07d667a1dd80ec00b635618c966c8d8542e16d5f1c4087129d2e7f01fc205cb81d711e9065e00
// #   - 0x5500000010000000550000005500000041000000b1cdaba59c4c2d0005d797a0557e9c2192840b6575113881b969dce52f33399115ab2e99859a94b7cddb0908d592d817b6699ff24dc87a1f4daa399e871bba2100
// #   - 0x
// # hash: 0x393dbe10d99f10836ee1160cef71506d12a9463d9009697458bd988ced76062e

// @test "Signing valid multi-input tx should pass - 2 - (Input 1, 1 cell)" {
//   run sendTransaction 090700001800000030000000480000004c000000a8060000050000002c00008035010080000000800000000000000000050000002c00008035010080000000800100000005000000030000005c0600001c00000020000000490000004d0000007a05000048060000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000002d05000010000000d30100006a030000c30100000c000000380000000000000000000000741afd3182e163d0936be988f7fa3d317b16765d3fb48f186d6d27dee4fb1f52000000008b0100001c00000020000000490000004d000000a900000077010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d9300000000010000000002000000000000000000000038e181c8cd1f37c737837675e67e80054f129b962e301fcecacbf59d6531659a000000000000000000000000e89cc327d406b4815f7c9d21025fb1ced236d22b06bbcb75a7a0a10b081b040e00000000ce0000000c0000006d00000061000000100000001800000061000000004429353a000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d61000000100000001800000061000000604116a804000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000057c33dd84df448ce997748502912a145f6805566140000000c000000100000000000000000000000970100000c00000038000000000000000000000023901dc31e18374f9a088f0033dcca6122f4e3646808c2e8b25983c4807e66b7010000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000000100000000000000000000004f26933c260b39c605b4fe848f506459d97f3f7a3b4c1a3de80b026dd7a3111400000000ce0000000c0000006d000000610000001000000018000000610000000018535224000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000a25a046d11a95b9bfaec33468060b576fc81eaff610000001000000018000000610000006031993e0a000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000065c634f3e742961c8a4e71191138a71ee5ef9591140000000c000000100000000000000000000000c30100000c000000380000000000000000000000619d37dd5910e4970a81546146f92d7eecb66a6174f8cb029f003c878c6243e4000000008b0100001c00000020000000490000004d000000a900000077010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000020000000000000000000000655832bef29d8d145d93c1db8c03066d004c67faf503d736d8fe5314edb608a80000000000000000000000003ec6a7bad02d5042c738235d0b9cb390643f09a33712d24e98f4899dcbaf0b7400000000ce0000000c0000006d00000061000000100000001800000061000000002ca07d51000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000065c634f3e742961c8a4e71191138a71ee5ef95916100000010000000180000006100000060ed39a40b000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000057c33dd84df448ce997748502912a145f6805566140000000c000000100000000000000000000000ce0000000c0000006d0000006100000010000000180000006100000000807c814a000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e421a57de6ed580189463131ccb6d5843dab975d6100000010000000180000006100000050fae56f4b000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000622f480dff8731d15c832d2234ee4eded0cfe398140000000c00000010000000000000000000000061000000080000005500000055000000100000005500000055000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
//   promptsCheck 6 tests/sign-valid-multi-input-tx-3-prompts.txt
//   rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
//   txhash_and_witness=393dbe10d99f10836ee1160cef71506d12a9463d9009697458bd988ced76062e550000000000000055000000100000005500000055000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
//   run check_signature "058000002c80000135800000000000000000000000" "$txhash_and_witness" "$rv"
//   diff <(echo $output) - <<<"Signature Verified Successfully"
// }

// @test "Signing valid multi-input tx should pass - 2 - (Input 2, 2 cells)" {
//   run sendTransaction 110700001800000030000000480000004c000000a8060000050000002c00008035010080000000800000000002000000050000002c00008035010080000000800100000005000000030000005c0600001c00000020000000490000004d0000007a05000048060000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000002d05000010000000d30100006a030000c30100000c000000380000000000000000000000741afd3182e163d0936be988f7fa3d317b16765d3fb48f186d6d27dee4fb1f52000000008b0100001c00000020000000490000004d000000a900000077010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d9300000000010000000002000000000000000000000038e181c8cd1f37c737837675e67e80054f129b962e301fcecacbf59d6531659a000000000000000000000000e89cc327d406b4815f7c9d21025fb1ced236d22b06bbcb75a7a0a10b081b040e00000000ce0000000c0000006d00000061000000100000001800000061000000004429353a000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d61000000100000001800000061000000604116a804000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000057c33dd84df448ce997748502912a145f6805566140000000c000000100000000000000000000000970100000c00000038000000000000000000000023901dc31e18374f9a088f0033dcca6122f4e3646808c2e8b25983c4807e66b7010000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000000100000000000000000000004f26933c260b39c605b4fe848f506459d97f3f7a3b4c1a3de80b026dd7a3111400000000ce0000000c0000006d000000610000001000000018000000610000000018535224000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000a25a046d11a95b9bfaec33468060b576fc81eaff610000001000000018000000610000006031993e0a000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000065c634f3e742961c8a4e71191138a71ee5ef9591140000000c000000100000000000000000000000c30100000c000000380000000000000000000000619d37dd5910e4970a81546146f92d7eecb66a6174f8cb029f003c878c6243e4000000008b0100001c00000020000000490000004d000000a900000077010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000020000000000000000000000655832bef29d8d145d93c1db8c03066d004c67faf503d736d8fe5314edb608a80000000000000000000000003ec6a7bad02d5042c738235d0b9cb390643f09a33712d24e98f4899dcbaf0b7400000000ce0000000c0000006d00000061000000100000001800000061000000002ca07d51000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000065c634f3e742961c8a4e71191138a71ee5ef95916100000010000000180000006100000060ed39a40b000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000057c33dd84df448ce997748502912a145f6805566140000000c000000100000000000000000000000ce0000000c0000006d0000006100000010000000180000006100000000807c814a000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e421a57de6ed580189463131ccb6d5843dab975d6100000010000000180000006100000050fae56f4b000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000622f480dff8731d15c832d2234ee4eded0cfe398140000000c000000100000000000000000000000690000000c00000065000000550000005500000010000000550000005500000041000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
//   promptsCheck 6 tests/sign-valid-multi-input-tx-4-prompts.txt
//   rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
//   txhash_and_witness=393dbe10d99f10836ee1160cef71506d12a9463d9009697458bd988ced76062e5500000000000000550000001000000055000000550000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
//   run check_signature "058000002c80000135800000000000000000000002" "$txhash_and_witness" "$rv"
//   diff <(echo $output) - <<<"Signature Verified Successfully"
// }

// # Signing a tx with 6 signers and 11 input cells total
// # current signer signs 3 input cells

// # version: 0
// # cell_deps:
// #   - out_point:
// #       tx_hash: 0x01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93
// #       index: 0
// #     dep_type: dep_group
// # header_deps: []
// # inputs:
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x3f73c1420ecf4ee7b67f2a41d02d8e6d7b564a61b3cd2370b405a82e1e9e3a63
// #       index: 0
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x32e63801a2a67840be36a31f42056e6f4ef0400548e39cc0311bcd93d648f976
// #       index: 0
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x32e63801a2a67840be36a31f42056e6f4ef0400548e39cc0311bcd93d648f976
// #       index: 1
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x80e736727ac08e31741f33359850a2fa1ed8e082908c1fbb02cf9d9133cee566
// #       index: 0
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x38e181c8cd1f37c737837675e67e80054f129b962e301fcecacbf59d6531659a
// #       index: 1
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0xfac70fd2f895c64e60db9dd895427209852841e443eb39bbb13d4bc81ac35261
// #       index: 1
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x4dbfe46d45f2330a661ec7bbf439aa5ba2cf6a39149ba1c85c47963e706837d6
// #       index: 0
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x3772e5f47d00993b8db0da7685ac27902c399ba6961275b8c7f8cd1286a3d1d6
// #       index: 0
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x4dbfe46d45f2330a661ec7bbf439aa5ba2cf6a39149ba1c85c47963e706837d6
// #       index: 1
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0xe89cc327d406b4815f7c9d21025fb1ced236d22b06bbcb75a7a0a10b081b040e
// #       index: 1
// #   - since: 0x0 (absolute block(0))
// #     previous_output:
// #       tx_hash: 0x5d21c687762a0418c061feef38afeb6015e26ef39c65a0945cdd598f469cb9fa
// #       index: 1
// # outputs:
// #   - capacity: "14000.0"
// #     lock:
// #       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
// #       args: 0xe421a57de6ed580189463131ccb6d5843dab975d
// #       hash_type: type
// #     type: ~
// #   - capacity: "659.9926"
// #     lock:
// #       code_hash: 0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8 (sighash)
// #       args: 0x622f480dff8731d15c832d2234ee4eded0cfe398
// #       hash_type: type
// #     type: ~
// # outputs_data:
// #   - 0x
// #   - 0x
// # witnesses:
// #   - 0x55000000100000005500000055000000410000006d69fc42ff87101dfcf48d87cf2f429b86b82630c8dacff4a64f3f117b6ae8db3f512bcacbe37a939043547e7ba31b6d54722d1311d6b9a1db96f43ffbc6798301
// #   - 0x550000001000000055000000550000004100000049efc9f25dc77bc57372d506e4920f8579b3ba2fd7fe3874002911a3c3f736df1a12298676c970096cadc7774bc1555cb7632df09c123d1ddfb197ae8f87c74400
// #   - 0x
// #   - 0x55000000100000005500000055000000410000004f738da54e10671e6c2bcbd4709fb80ae2d15f3afedc9882e6cf9c77e5701183375d9a7d0d6e62eb2580e5ca2893272e343fae986bf146f18ab4633b8920191f01
// #   - 0x55000000100000005500000055000000410000001ede13a7eec07936f291a696b5a0e480291dd674cbc8f281ad0b36008c3ad0066af6bbed3d4d53018f35bb6996218c2c438a0a42566b456412afad31fc70bab100
// #   - 0x5500000010000000550000005500000041000000c421e8a03a27c38f265e3d11b6357bc58294752f84dc3422d6ec44652084c6192ec5131699c6875233e81e59cd458588c384084a59e700b689d94ecf5c7d3a2c00
// #   - 0x
// #   - 0x
// #   - 0x55000000100000005500000055000000410000008fdd6dce8be1efec419211409bf8cf6e2e9706ddf497c99d034fd0c3267bd3301bfa66f1a4ddcd61c77115e4fd54256901e73d70e09bbd4402e2a0d5b92bc2bc01
// #   - 0x
// #   - 0x
// # hash: 0xc69c52275bb4eba229d9a5225e0f45e904e2345a8a05c1a3b84bac2b41dd19aa

// @test "Signing valid multi-input tx should pass - 3" {
//   run sendTransaction 751400001800000030000000480000004c00000004140000050000002c00008035010080000000800100000005000000050000002c000080350100800000008001000000050000000b000000b81300001c00000020000000490000004d000000d6120000a4130000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d9300000000010000000089120000300000004b020000e20300007905000010070000d30800006a0a0000010c0000980d00002f0f0000f21000001b0200000c0000003800000000000000000000003f73c1420ecf4ee7b67f2a41d02d8e6d7b564a61b3cd2370b405a82e1e9e3a6300000000e30100001c00000020000000490000004d00000001010000cf010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000040000000000000000000000768707ea273d3268a13b206334bc51a4071d5f92dd18da886df270927e25470b000000000000000000000000ac637a6de82940983b177975312dc9648198addcd27e7e2dd776a51fb91a26350000000000000000000000005d21c687762a0418c061feef38afeb6015e26ef39c65a0945cdd598f469cb9fa0000000000000000000000001a13aee11a9ae54757b513181c91a9df829d822199c567814906838b8074689800000000ce0000000c0000006d000000610000001000000018000000610000000098053933000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e5260d839a786ac2a909181df9a423f1efbe863d610000001000000018000000610000006061754817000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000057c33dd84df448ce997748502912a145f6805566140000000c000000100000000000000000000000970100000c00000038000000000000000000000032e63801a2a67840be36a31f42056e6f4ef0400548e39cc0311bcd93d648f976000000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000000100000000000000000000002e4f4999bc2ae5d1bf1964d1fb4fa2d7c9dff014faa0fb4130fcaf053a828b6b00000000ce0000000c0000006d0000006100000010000000180000006100000000e6bd4f57000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000005bbd584d1b00002ef1dcfdb5988f0ffd748df0c6100000010000000180000006100000060030a6334000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000005bbd584d1b00002ef1dcfdb5988f0ffd748df0c140000000c000000100000000000000000000000970100000c00000038000000000000000000000032e63801a2a67840be36a31f42056e6f4ef0400548e39cc0311bcd93d648f976010000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000000100000000000000000000002e4f4999bc2ae5d1bf1964d1fb4fa2d7c9dff014faa0fb4130fcaf053a828b6b00000000ce0000000c0000006d0000006100000010000000180000006100000000e6bd4f57000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000005bbd584d1b00002ef1dcfdb5988f0ffd748df0c6100000010000000180000006100000060030a6334000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000005bbd584d1b00002ef1dcfdb5988f0ffd748df0c140000000c000000100000000000000000000000970100000c00000038000000000000000000000080e736727ac08e31741f33359850a2fa1ed8e082908c1fbb02cf9d9133cee566000000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000010000000000000000000000f44b26dda9f1f48b20029654be67c2e636b7fec62b877e20b695c2307dae4a5201000000ce0000000c0000006d00000061000000100000001800000061000000005cb2ec22000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce801140000004c73d21a2cd6501255bf410dcab0265c2ee1fdcb61000000100000001800000061000000203e6fe7d06ac11b490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000cc4e78b857b8ea477304925ac0f67b7348b86761140000000c000000100000000000000000000000c30100000c00000038000000000000000000000038e181c8cd1f37c737837675e67e80054f129b962e301fcecacbf59d6531659a010000008b0100001c00000020000000490000004d000000a900000077010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d930000000001000000000200000000000000000000006127c3e68295fb18d6ed55256f5ac3bb81c3446c671ff029db7ad7992bc7b394010000000000000000000000dccc65d2b03f6b30d8cb48a3ab630ac26c73257557ce62320cc911a02fb816b400000000ce0000000c0000006d00000061000000100000001800000061000000005cb2ec22000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e421a57de6ed580189463131ccb6d5843dab975d6100000010000000180000006100000010d52a5009000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000083462eafd93f0a598ab26597e5cda6523b2fc153140000000c000000100000000000000000000000970100000c000000380000000000000000000000fac70fd2f895c64e60db9dd895427209852841e443eb39bbb13d4bc81ac35261010000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d9300000000010000000001000000000000000000000039641a05511b85d641cc844d0e0e7766983c9a26b1d62d51f251de7125390b1601000000ce0000000c0000006d0000006100000010000000180000006100000000c817a804000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000f941fd7b5f5ef376561a32d0c5b0bb1cd11802d661000000100000001800000061000000c04a44f80d000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000071882946c87d62f9b2f2b5be3be6b5c2704fec59140000000c000000100000000000000000000000970100000c0000003800000000000000000000004dbfe46d45f2330a661ec7bbf439aa5ba2cf6a39149ba1c85c47963e706837d6000000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000010000000000000000000000f44b26dda9f1f48b20029654be67c2e636b7fec62b877e20b695c2307dae4a5200000000ce0000000c0000006d000000610000001000000018000000610000000078a69820000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000071882946c87d62f9b2f2b5be3be6b5c2704fec5961000000100000001800000061000000605d0a5402000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000622f480dff8731d15c832d2234ee4eded0cfe398140000000c000000100000000000000000000000970100000c0000003800000000000000000000003772e5f47d00993b8db0da7685ac27902c399ba6961275b8c7f8cd1286a3d1d6000000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000010000000000000000000000be3abd7565dd5e106a454368d7acec71c7a5114121d9dfe07ad54c48434f615c00000000ce0000000c0000006d0000006100000010000000180000006100000000046bf414000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000071882946c87d62f9b2f2b5be3be6b5c2704fec5961000000100000001800000061000000605d0a5402000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce801140000008d5520741f06a062543cdea9a21fc20d07ee29b0140000000c000000100000000000000000000000970100000c0000003800000000000000000000004dbfe46d45f2330a661ec7bbf439aa5ba2cf6a39149ba1c85c47963e706837d6010000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000010000000000000000000000f44b26dda9f1f48b20029654be67c2e636b7fec62b877e20b695c2307dae4a5200000000ce0000000c0000006d000000610000001000000018000000610000000078a69820000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8011400000071882946c87d62f9b2f2b5be3be6b5c2704fec5961000000100000001800000061000000605d0a5402000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000622f480dff8731d15c832d2234ee4eded0cfe398140000000c000000100000000000000000000000c30100000c000000380000000000000000000000e89cc327d406b4815f7c9d21025fb1ced236d22b06bbcb75a7a0a10b081b040e010000008b0100001c00000020000000490000004d000000a900000077010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93000000000100000000020000000000000000000000b9244b1e4a2fb7b4f5ae7e511a0f54b918ba1547c31e0fd6dad84009ca4cc76500000000000000000000000016de7c6b4ff30f8395eafd182df5cd4bbb1065bdccc9270c563a1335c8b2472700000000ce0000000c0000006d0000006100000010000000180000006100000000b08ef01b000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e421a57de6ed580189463131ccb6d5843dab975d61000000100000001800000061000000f0a017a804000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000622f480dff8731d15c832d2234ee4eded0cfe398140000000c000000100000000000000000000000970100000c0000003800000000000000000000005d21c687762a0418c061feef38afeb6015e26ef39c65a0945cdd598f469cb9fa010000005f0100001c00000020000000490000004d0000007d0000004b010000000000000100000001ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d9300000000010000000001000000000000000000000023901dc31e18374f9a088f0033dcca6122f4e3646808c2e8b25983c4807e66b700000000ce0000000c0000006d0000006100000010000000180000006100000000c817a804000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e421a57de6ed580189463131ccb6d5843dab975d61000000100000001800000061000000f0283baa1f000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000622f480dff8731d15c832d2234ee4eded0cfe398140000000c000000100000000000000000000000ce0000000c0000006d0000006100000010000000180000006100000000b080f645010000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000e421a57de6ed580189463131ccb6d5843dab975d6100000010000000180000006100000060c9dc5d0f000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce80114000000622f480dff8731d15c832d2234ee4eded0cfe398140000000c0000001000000000000000000000007100000010000000690000006d00000055000000550000001000000055000000550000004100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
//   promptsCheck 6 tests/sign-valid-multi-input-tx-5-prompts.txt
//   rv="$(egrep "<= b'.*'9000" <(echo "$output")|cut -d"'" -f2)"
//   txhash_and_witness=c69c52275bb4eba229d9a5225e0f45e904e2345a8a05c1a3b84bac2b41dd19aa55000000000000005500000010000000550000005500000041000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
//   run check_signature "058000002c80000135800000000000000100000005" "$txhash_and_witness" "$rv"
//   diff <(echo $output) - <<<"Signature Verified Successfully"
// }

context('Signing multi-input transactions', function() {

  it("Signing valid multi-input tx should pass - 1 - (Input 1)", async function() {
    const createMultiInputTx = {
      "signPath": [
        2147483692,
        2147483957,
        2147483648
      ],
      "changePath": [
        2147483692,
        2147483957,
        2147483648,
        1,
        0
      ],
      "inputCount": 2,
      "raw": {
        "version": 0,
        "cell_deps": [
          {
            "out_point": {
              "tx_hash": "01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93",
              "index": 0
            },
            "dep_type": 1
          }
        ],
        "header_deps": [],
        "inputs": [
          {
            "input": {
              "since": "0000000000000000",
              "previous_output": {
                "tx_hash": "6127c3e68295fb18d6ed55256f5ac3bb81c3446c671ff029db7ad7992bc7b394",
                "index": 1
              }
            },
            "source": {
              "version": 0,
              "cell_deps": [
                {
                  "out_point": {
                    "tx_hash": "01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93",
                    "index": 0
                  },
                  "dep_type": 1
                }
              ],
              "header_deps": [],
              "inputs": [
                {
                  "since": "0000000000000000",
                  "previous_output": {
                    "tx_hash": "276d5447f20df863b13bcafd63de2ad851e4f35eda337268b19ab0cf7c29c608",
                    "index": 1
                  }
                },
                {
                  "since": "0000000000000000",
                  "previous_output": {
                    "tx_hash": "40e54fc2d1aabbd39ae6cd8a5df922995dd856f24f670d3d5f283690a534a544",
                    "index": 0
                  }
                }
              ],
              "outputs": [
                {
                  // "capacity": "00ac23fc06000000",
                  "capacity": "00000006fc23ac00",
                  "lock": {
                    "code_hash": "5c5069eb0857efc65e1bca0c07df34c31663b3622fd3876c876320fc9634e2a8",
                    "hash_type": 1,
                    "args": "98ac6e82110a9ef50923375bfdcbef6fd979b8ac6000003804080720"
                  },
                  "type_": null
                },
                {
                  // "capacity": "207066f414000000",
                  "capacity": "00000014f4667020",
                  "lock": {
                    "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
                    "hash_type": 1,
                    "args": "8d5520741f06a062543cdea9a21fc20d07ee29b0"
                  },
                  "type_": null
                }
              ],
              "outputs_data": [
                "",
                ""
              ]
            }
          },
          {
            "input": {
              "since": "0000000000000000",
              "previous_output": {
                "tx_hash": "dccc65d2b03f6b30d8cb48a3ab630ac26c73257557ce62320cc911a02fb816b4",
                "index": 0
              }
            },
            "source": {
              "version": 0,
              "cell_deps": [
                {
                  "out_point": {
                    "tx_hash": "01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93",
                    "index": 0
                  },
                  "dep_type": 1
                }
              ],
              "header_deps": [],
              "inputs": [
                {
                  "since": "0000000000000000",
                  "previous_output": {
                    "tx_hash": "39738e9ad7b3ac419a51a9d301cb96722d3e01f2ffbae7779bd31791fc24adad",
                    "index": 1
                  }
                }
              ],
              "outputs": [
                {
                  // "capacity": "00e8764817000000",
                  "capacity": "000000174876e800",
                  "lock": {
                    "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
                    "hash_type": 1,
                    "args": "e5260d839a786ac2a909181df9a423f1efbe863d"
                  },
                  "type_": null
                },
                {
                  // "capacity": "40bf094de86bc11b",
                  "capacity": "1bc16be84d09bf40",
                  "lock": {
                    "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
                    "hash_type": 1,
                    "args": "cc4e78b857b8ea477304925ac0f67b7348b86761"
                  },
                  "type_": null
                }
              ],
              "outputs_data": [
                "",
                ""
              ]
            }
          }
        ],
        "outputs": [
          {
            // "capacity": "005cb2ec22000000",
            "capacity": "00000022ecb25c00",
            "lock": {
              "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
              "hash_type": 1,
              "args": "e421a57de6ed580189463131ccb6d5843dab975d"
            },
            "type_": null
          },
          {
            // "capacity": "10d52a5009000000",
            "capacity": "00000009502ad510",
            "lock": {
              "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
              "hash_type": 1,
              "args": "83462eafd93f0a598ab26597e5cda6523b2fc153"
            },
            "type_": null
          }
        ],
        "outputs_data": [
          "",
          ""
        ]
      },
      "witnesses": [
        "",
        ""
      ]
    };

    const flow = await flowAccept(this.speculos, [
      { header: "Confirm", body: "Multi-Input Transaction"},                            // Prompt 0
      { header: "Input", body: "1 of 2"},                                               // Prompt 1
      { header: "Source", body: "ckb1qyqg64fqws0sdgrz2s7da2dzrlpq6plw9xcqhuexcr"},      // Prompt 2
      { header: "Amount", body: "899.997 of 1500"},                                     // Prompt 3
      { header: "Fee", body: "0.0001"},                                                 // Prompt 4
      { header: "Destination", body: "ckb1qyqwggd90hnw6kqp39rrzvwvkm2cg0dtjawsuayfag"}, // Prompt 5
    ]);

    const signature = await this.ckb.signAnnotatedTransaction(createMultiInputTx);

    expect(signature).to.equal("f685d0c3f31b01a6285a1697880d51c0a4dd109783ef959d37056976a2238e94116179f7c1354319aeb34bbfbdbb0fee8d238942509dcecff4d5e0dfd54f29c500");

    await flow.promptsPromise;
  });

  it("Signing valid multi-input tx should pass - 2 - (Input 2)", async function() {
    // wallet transfer
    // --from-account 0x8d5520741f06a062543cdea9a21fc20d07ee29b0
    // --to-address ckt1qyqwggd90hnw6kqp39rrzvwvkm2cg0dtjawspc6k35
    // --capacity 3200
    // --tx-fee 0.0001
    // --derive-change-address ckt1qyqxyt6gphlcwvw3tjpj6g35ae8da5x0uwvqrprflz
    // --derive-change-address-length 6

    const createMultiInputTx2 = {
      "signPath": [
        2147483692,
        2147483957,
        2147483648,
        0,
        0
      ],
      "changePath": [
        2147483692,
        2147483957,
        2147483648,
        1,
        0
      ],
      "inputCount": 2,
      "raw": {
        "version": 0,
        "cell_deps": [
          {
            "out_point": {
              "tx_hash": "01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93",
              "index": 0
            },
            "dep_type": 1
          }
        ],
        "header_deps": [],
        "inputs": [
          {
            "input": {
              "since": "0000000000000000",
              "previous_output": {
                "tx_hash": "6127c3e68295fb18d6ed55256f5ac3bb81c3446c671ff029db7ad7992bc7b394",
                "index": 1
              }
            },
            "source": {
              "version": 0,
              "cell_deps": [
                {
                  "out_point": {
                    "tx_hash": "01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93",
                    "index": 0
                  },
                  "dep_type": 1
                }
              ],
              "header_deps": [],
              "inputs": [
                {
                  "since": "0000000000000000",
                  "previous_output": {
                    "tx_hash": "276d5447f20df863b13bcafd63de2ad851e4f35eda337268b19ab0cf7c29c608",
                    "index": 1
                  }
                },
                {
                  "since": "0000000000000000",
                  "previous_output": {
                    "tx_hash": "40e54fc2d1aabbd39ae6cd8a5df922995dd856f24f670d3d5f283690a534a544",
                    "index": 0
                  }
                }
              ],
              "outputs": [
                {
                  // "capacity": "00 ac 23 fc 06 00 00 00",
                  "capacity":"00000006fc23ac00",
                  "lock": {
                    "code_hash": "5c5069eb0857efc65e1bca0c07df34c31663b3622fd3876c876320fc9634e2a8",
                    "hash_type": 1,
                    "args": "98ac6e82110a9ef50923375bfdcbef6fd979b8ac6000003804080720"
                  },
                  "type_": null
                },
                {
                  "capacity": "20 70 66 f4 14 00 00 00",
                  "capacity":"00000014f4667020",
                  "lock": {
                    "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
                    "hash_type": 1,
                    "args": "8d5520741f06a062543cdea9a21fc20d07ee29b0"
                  },
                  "type_": null
                }
              ],
              "outputs_data": [
                "",
                ""
              ]
            }
          },
          {
            "input": {
              "since": "0000000000000000",
              "previous_output": {
                "tx_hash": "dccc65d2b03f6b30d8cb48a3ab630ac26c73257557ce62320cc911a02fb816b4",
                "index": 0
              }
            },
            "source": {
              "version": 0,
              "cell_deps": [
                {
                  "out_point": {
                    "tx_hash": "01ef8910ef4e71349763523a077eea304b0e852c45b04d5b56c482306f4f6d93",
                    "index": 0
                  },
                  "dep_type": 1
                }
              ],
              "header_deps": [],
              "inputs": [
                {
                  "since": "0000000000000000",
                  "previous_output": {
                    "tx_hash": "39738e9ad7b3ac419a51a9d301cb96722d3e01f2ffbae7779bd31791fc24adad",
                    "index": 1
                  }
                }
              ],
              "outputs": [
                {
                  // "capacity": "00 e8 76 48 17 00 00 00",
                  "capacity":"000000174876e800",
                  "lock": {
                    "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
                    "hash_type": 1,
                    "args": "e5260d839a786ac2a909181df9a423f1efbe863d"
                  },
                  "type_": null
                },
                {
                  // "capacity": "40 bf 09 4d e8 6b c1 1b",
                  "capacity":"1bc16be84d09bf40",
                  "lock": {
                    "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
                    "hash_type": 1,
                    "args": "cc4e78b857b8ea477304925ac0f67b7348b86761"
                  },
                  "type_": null
                }
              ],
              "outputs_data": [
                "",
                ""
              ]
            }
          }
        ],
        "outputs": [
          {
            // 00 00
            // 5c 00
            // b2 00
            // ec 22
            // 22 ec
            // 00 b2
            // 00 5c
            // 00 00
            // "capacity": "005cb2ec22000000",
            "capacity": "0x00000022ecb25c00",
            "lock": {
              "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
              "hash_type": 1,
              "args": "e421a57de6ed580189463131ccb6d5843dab975d"
            },
            "type_": null
          },
          {
            // "capacity": "10d52a5009000000",
            "capacity": "0x00000009502ad510",
            "lock": {
              "code_hash": "9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
              "hash_type": 1,
              "args": "83462eafd93f0a598ab26597e5cda6523b2fc153"
            },
            "type_": null
          }
        ],
        "outputs_data": [
          "",
          ""
        ]
      },
      "witnesses": [
        "0x5500000010000000550000005500000041000000456049d307a11353d7520d1756c38ef6bcb20b00cc90536420768cb6e08916475ceed3b38f8f05481f2d2b7deba4fd3335e22495c00a8d7f8715a4258378cdfe00",
        "0x55000000100000005500000055000000410000007766519eed01f9534e44b03b0fcc0bcd7bbc1d96f7fb9373707e260df27739f15c07811508ef5b460f5e09773c62436ea0ccff4c564aff3d561c7a097e1a186901"
      ]
    };

    const flow = await flowAccept(this.speculos, [
      { header: "Confirm", body: "Multi-Input Transaction"},                       // Prompt 0
      { header: "Input", body: "2 of 2"},                                          // Prompt 1
      { header: "Source", body: "ckb1qyqw2fsdswd8s6kz4yy3s80e5s3lrma7sc7sugcvv9"}, // Prompt 2
      { header: "Amount", body: "1000 of 1500"}, // Prompt 3 (ORIGINAL)
      { header: "Fee", body: "0.0001"},          // Prompt 4 (ORIGINAL)
      { header: "Destination", body: "ckb1qyqwggd90hnw6kqp39rrzvwvkm2cg0dtjawsuayfag"}, // Prompt 5
    ]);

    const signature = await this.ckb.signAnnotatedTransaction(createMultiInputTx2);

    expect(signature).to.equal("1bfbb16bc1036e9e83ac28e2f094d7956b629586c922a5959af70d3db7193a2e38647871c2f9b8659243fe00de15d749bd757e64c7337b9450245d9440306db800");

    await flow.promptsPromise;
  });
});
